import F from"./DCrISlLf.js";import{_ as v,x as u,y as m,z as r,B as l,D as _,A as f,I as p,J as g,K as x,L as y,M as N,N as V,O,P,Q as S,R as b}from"#entry";import{u as w}from"./DTZZFK40.js";const k={name:"ContadoresFiltros",props:{filtroNombre:{type:String,default:""},ordenarPor:{type:String,default:""},direccionOrden:{type:String,default:"asc"},tipoFiltroValor:{type:String,default:""},valorFiltro:{type:[Number,null],default:null}},emits:["filters-change","clear-filters"],data(){return{mostrarFiltros:!1}},computed:{hayFiltrosActivos(){return this.filtroNombre.trim()||this.ordenarPor||this.tipoFiltroValor},conteoFiltrosActivos(){let t=0;return this.filtroNombre.trim()&&t++,this.ordenarPor&&t++,this.tipoFiltroValor&&t++,t}},mounted(){const t=sessionStorage.getItem("contadores_filtros_toggle");t!==null&&(this.mostrarFiltros=JSON.parse(t))},methods:{toggleFiltros(){this.mostrarFiltros=!this.mostrarFiltros,sessionStorage.setItem("contadores_filtros_toggle",JSON.stringify(this.mostrarFiltros))},updateFiltroNombre(t){this.emitFiltersChange({filtroNombre:t.target.value})},updateOrdenarPor(t){this.emitFiltersChange({ordenarPor:t.target.value})},updateDireccionOrden(t){this.emitFiltersChange({direccionOrden:t.target.value})},updateTipoFiltroValor(t){this.emitFiltersChange({tipoFiltroValor:t.target.value})},updateValorFiltro(t){const o=t.target.value?Number(t.target.value):null;this.emitFiltersChange({valorFiltro:o})},emitFiltersChange(t={}){this.$emit("filters-change",{filtroNombre:t.filtroNombre??this.filtroNombre,ordenarPor:t.ordenarPor??this.ordenarPor,direccionOrden:t.direccionOrden??this.direccionOrden,tipoFiltroValor:t.tipoFiltroValor??this.tipoFiltroValor,valorFiltro:t.valorFiltro??this.valorFiltro})},limpiarFiltros(){this.$emit("clear-filters")}}},E={class:"filtros"},I={class:"u-flex u-flex--justify-between u-flex--center u-mb--md"},A={class:"u-mb--none u-text--muted"},T=["aria-expanded"],L={class:"u-mb--md"},B={class:"form__label u-text--sm u-text--semibold"},z=["value"],D={class:"filtros__grid u-mb--md"},j={class:"form__field"},J={class:"form__label u-text--sm u-text--semibold"},M={class:"u-flex u-gap--sm"},K=["value"],U=["value","disabled"],$={class:"form__field"},G={class:"form__label u-text--sm u-text--semibold"},Q={class:"u-flex u-gap--sm"},R=["value"],W=["value","disabled"],q={key:0,class:"u-flex u-flex--justify-between u-flex--center"},H={class:"filtros__activos"},X={class:"u-text--muted"};function Y(t,o,i,d,s,e){const c=F;return m(),u("div",E,[r("div",I,[r("h6",A,[l(c,{name:"heroicons:funnel",class:"u-me--sm"}),o[7]||(o[7]=_(" Filtros y Ordenamiento ",-1))]),r("button",{class:"btn btn--outline-secondary btn--sm","aria-expanded":s.mostrarFiltros,"aria-controls":"filtros-content",onClick:o[0]||(o[0]=(...n)=>e.toggleFiltros&&e.toggleFiltros(...n))},[l(c,{name:s.mostrarFiltros?"heroicons:chevron-up":"heroicons:chevron-down"},null,8,["name"]),_(" "+f(s.mostrarFiltros?"Ocultar":"Mostrar"),1)],8,T)]),r("div",{id:"filtros-content",class:g(["filtros__content",{"filtros__content--show":s.mostrarFiltros}])},[r("div",L,[r("label",B,[l(c,{name:"heroicons:magnifying-glass",class:"u-me--xs"}),o[8]||(o[8]=_(" Buscar por nombre ",-1))]),r("input",{value:i.filtroNombre,type:"text",class:"form__input",placeholder:"Escriba el nombre del contador...",onInput:o[1]||(o[1]=(...n)=>e.updateFiltroNombre&&e.updateFiltroNombre(...n))},null,40,z)]),r("div",D,[r("div",j,[r("label",J,[l(c,{name:"heroicons:bars-arrow-up",class:"u-me--xs"}),o[9]||(o[9]=_(" Ordenar por ",-1))]),r("div",M,[r("select",{value:i.ordenarPor,class:"form__input form__input--sm",onChange:o[2]||(o[2]=(...n)=>e.updateOrdenarPor&&e.updateOrdenarPor(...n))},[...o[10]||(o[10]=[r("option",{value:""},"Sin ordenar",-1),r("option",{value:"nombre"},"Nombre",-1),r("option",{value:"valor"},"Valor",-1)])],40,K),r("select",{value:i.direccionOrden,disabled:!i.ordenarPor,class:"form__input form__input--sm",onChange:o[3]||(o[3]=(...n)=>e.updateDireccionOrden&&e.updateDireccionOrden(...n))},[...o[11]||(o[11]=[r("option",{value:"asc"},"Ascendente",-1),r("option",{value:"desc"},"Descendente",-1)])],40,U)])]),r("div",$,[r("label",G,[l(c,{name:"heroicons:adjustments-horizontal",class:"u-me--xs"}),o[12]||(o[12]=_(" Filtrar por valor ",-1))]),r("div",Q,[r("select",{value:i.tipoFiltroValor,class:"form__input form__input--sm",onChange:o[4]||(o[4]=(...n)=>e.updateTipoFiltroValor&&e.updateTipoFiltroValor(...n))},[...o[13]||(o[13]=[r("option",{value:""},"Sin filtro",-1),r("option",{value:"mayor"},"Mayor a",-1),r("option",{value:"menor"},"Menor a",-1)])],40,R),r("input",{value:i.valorFiltro,type:"number",class:"form__input form__input--sm",placeholder:"Valor",min:"0",max:"20",disabled:!i.tipoFiltroValor,onInput:o[5]||(o[5]=(...n)=>e.updateValorFiltro&&e.updateValorFiltro(...n))},null,40,W)])])]),e.hayFiltrosActivos?(m(),u("div",q,[r("div",H,[r("small",X,[l(c,{name:"heroicons:information-circle",class:"u-me--xs"}),_(" "+f(e.conteoFiltrosActivos)+" filtro(s) aplicado(s) ",1)])]),r("button",{class:"btn btn--outline-danger btn--sm",title:"Limpiar todos los filtros",onClick:o[6]||(o[6]=(...n)=>e.limpiarFiltros&&e.limpiarFiltros(...n))},[l(c,{name:"heroicons:x-mark",class:"u-me--xs"}),o[14]||(o[14]=_(" Limpiar filtros ",-1))])])):p("",!0)],2)])}const Z=Object.assign(v(k,[["render",Y],["__scopeId","data-v-e72e31dd"]]),{__name:"ContadoresFiltros"}),oo={setup(){const{showSuccess:t,showError:o,showWarning:i}=w();return{showSuccess:t,showError:o,showWarning:i}},data(){return{filtroNombre:"",ordenarPor:"",direccionOrden:"asc",tipoFiltroValor:"",valorFiltro:null}},computed:{...y("contadores",{listaContadores:"listaContadores",puedeAgregarContador:"puedeAgregarContador",cantidadContadores:"cantidadContadores",maxContadores:"maxContadores",maxValorContador:"maxValorContador",maxCaracteresNombre:"maxCaracteresNombre"}),contadoresFiltrados(){let t=[...this.listaContadores];return this.filtroNombre.trim()&&(t=t.filter(o=>o.nombre.toLowerCase().includes(this.filtroNombre.toLowerCase()))),this.tipoFiltroValor&&this.valorFiltro!==null&&(this.tipoFiltroValor==="mayor"?t=t.filter(o=>o.valor>this.valorFiltro):this.tipoFiltroValor==="menor"&&(t=t.filter(o=>o.valor<this.valorFiltro))),this.ordenarPor&&t.sort((o,i)=>{let d,s;return this.ordenarPor==="nombre"?(d=o.nombre.toLowerCase(),s=i.nombre.toLowerCase()):this.ordenarPor==="valor"&&(d=o.valor,s=i.valor),this.direccionOrden==="asc"?d<s?-1:d>s?1:0:d>s?-1:d<s?1:0}),t},sumaTotal(){return this.listaContadores.reduce((t,o)=>t+o.valor,0)},hayFiltrosActivos(){return this.filtroNombre.trim()||this.ordenarPor||this.tipoFiltroValor}},mounted(){this.loadContadores(),this.loadFiltersFromSession()},methods:{...x("contadores",{removeContador:"removeContador",incrementarContador:"incrementarContador",decrementarContador:"decrementarContador",editarNombreContador:"editarNombreContador",loadContadores:"loadContadores"}),async eliminarContador(t){try{const o=this.listaContadores.find(d=>d.id===t),i=o?o.nombre:"Contador";await this.removeContador(t),this.showSuccess(`"${i}" eliminado exitosamente`)}catch(o){console.error("Error al eliminar contador:",o),this.showError("Error al eliminar el contador. Inténtalo de nuevo.")}},startEdit(t){const o=this.listaContadores.find(i=>i.id===t);o&&(o.editando=!0)},async finishEdit(t){const o=this.listaContadores.find(i=>i.id===t);if(o)try{await this.editarNombreContador({id:t,nombre:o.nombre}),o.editando=!1,this.showSuccess(`Nombre actualizado a "${o.nombre}"`)}catch(i){console.error("Error al editar nombre:",i),this.showError("Error al actualizar el nombre. Inténtalo de nuevo."),o.editando=!1}},cancelEdit(t){const o=this.listaContadores.find(i=>i.id===t);o&&(this.loadContadores(),o.editando=!1)},handleFiltersChange(t){this.filtroNombre=t.filtroNombre,this.ordenarPor=t.ordenarPor,this.direccionOrden=t.direccionOrden,this.tipoFiltroValor=t.tipoFiltroValor,this.valorFiltro=t.valorFiltro,this.saveFiltersToSession()},limpiarTodosFiltros(){this.filtroNombre="",this.ordenarPor="",this.direccionOrden="asc",this.tipoFiltroValor="",this.valorFiltro=null,sessionStorage.removeItem("contadores_filtros")},saveFiltersToSession(){const t={filtroNombre:this.filtroNombre,ordenarPor:this.ordenarPor,direccionOrden:this.direccionOrden,tipoFiltroValor:this.tipoFiltroValor,valorFiltro:this.valorFiltro};sessionStorage.setItem("contadores_filtros",JSON.stringify(t))},loadFiltersFromSession(){const t=sessionStorage.getItem("contadores_filtros");if(t)try{const o=JSON.parse(t);this.filtroNombre=o.filtroNombre||"",this.ordenarPor=o.ordenarPor||"",this.direccionOrden=o.direccionOrden||"asc",this.tipoFiltroValor=o.tipoFiltroValor||"",this.valorFiltro=o.valorFiltro||null}catch(o){console.warn("Error al cargar filtros desde sessionStorage:",o)}}}},to={class:"lista-contadores"},ro={class:"card u-p--md"},eo={key:1,class:"empty-state u-text--center u-py--lg"},io={class:"empty-state__icon u-mb--md"},so={class:"contador-item__list"},no={class:"contador-item__content"},ao={class:"contador-item__nombre"},lo=["onClick"],co=["onUpdate:modelValue","onBlur","onKeydown"],mo=["disabled","onClick"],uo={class:"contador-item__valor"},ho=["onClick"],_o=["onClick"];function fo(t,o,i,d,s,e){const c=Z,n=F;return m(),u("div",to,[r("div",ro,[t.listaContadores.length>0?(m(),N(c,{key:0,"filtro-nombre":s.filtroNombre,"ordenar-por":s.ordenarPor,"direccion-orden":s.direccionOrden,"tipo-filtro-valor":s.tipoFiltroValor,"valor-filtro":s.valorFiltro,onFiltersChange:e.handleFiltersChange,onClearFilters:e.limpiarTodosFiltros},null,8,["filtro-nombre","ordenar-por","direccion-orden","tipo-filtro-valor","valor-filtro","onFiltersChange","onClearFilters"])):p("",!0),t.listaContadores.length===0?(m(),u("div",eo,[r("div",io,[l(n,{name:"heroicons:plus-circle-16-solid",size:"64",style:{color:"var(--secondary)"}})]),o[0]||(o[0]=r("h5",{class:"u-text--muted"},"No hay contadores disponibles",-1)),o[1]||(o[1]=r("p",{class:"u-text--muted"},'Usa el botón "Agregar Contador" en el header para comenzar',-1))])):p("",!0),r("ul",so,[(m(!0),u(V,null,O(e.contadoresFiltrados,a=>(m(),u("li",{key:a.id,class:"contador-item"},[r("div",no,[r("div",ao,[a.editando?P((m(),u("input",{key:1,"onUpdate:modelValue":h=>a.nombre=h,class:"contador-item__input",type:"text",onBlur:h=>e.finishEdit(a.id),onKeydown:[b(h=>e.finishEdit(a.id),["enter"]),b(h=>e.cancelEdit(a.id),["escape"])]},null,40,co)),[[S,a.nombre]]):(m(),u("div",{key:0,class:"contador-item__name-display",onClick:h=>e.startEdit(a.id)},f(a.nombre),9,lo))]),r("button",{class:"btn btn--outline-warning btn--sm",disabled:a.valor===0,onClick:h=>t.decrementarContador(a.id)},[l(n,{name:"heroicons:minus"})],8,mo),r("div",uo,f(a.valor),1),r("button",{class:"btn btn--outline-success btn--sm",onClick:h=>t.incrementarContador(a.id)},[l(n,{name:"heroicons:plus"})],8,ho),r("button",{class:"btn btn--outline-danger btn--sm",onClick:h=>e.eliminarContador(a.id)},[l(n,{name:"heroicons:trash"})],8,_o)])]))),128))])])])}const C=Object.assign(v(oo,[["render",fo]]),{__name:"ListaContadores"}),po={components:{ListaContadores:C}};function vo(t,o,i,d,s,e){const c=C;return m(),u("div",null,[l(c)])}const go=v(po,[["render",vo]]);export{go as default};
